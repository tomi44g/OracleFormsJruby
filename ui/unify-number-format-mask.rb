require 'java'
require 'frmjdapi.jar'
require 'fileutils'
include FileUtils

module M
  include_package 'oracle.forms.jdapi';

  masks_map = {
  '9,99,99,999.99' => 'FM9G99G99G999D99',
  '9,999,999' => 'FM9G999G999',
  '90D00' => 'FM90D00',
  '90D000' => 'FM90D000',
  '90d999' => 'FM90D999',
  '99,99,999.99' => 'FM99G99G999D99',
  '99,990.00MI' => '99G990D00MI',
  '99,999,999,990.00MI' => '99G999G999G990D00MI',
  '99,999,999.00' => 'FM99G999G999D00',
  '99.90' => 'FM99D90',
  '990' => 'FM990',
  '990.0' => 'FM990D0',
  '990D00' => 'FM990D00',
  '990D999' => 'FM990D999',
  '999' => 'FM999',
  '999,990.00' => 'FM999G990D00',
  '999,999,990' => 'FM999G999G990',
  '999,999,990.00' => 'FM999G999G990D00',
  '999,999,990.00MI' => '999G999G990D00MI',
  '999,999,999,990.00' => 'FM999G999G999G990D00',
  '999,999,999,990.00MI' => '999G999G999G990D00MI',
  '999,999,999,990MI' => '999G999G999G990MI',
  '999,999,999,999,990.00MI' => '999G999G999G999G990D00MI',
  '999,999,999,999.99MI' => '999G999G999G999D99MI',
  '999,999,999.99' => 'FM999G999G999D99',
  '9990' => 'FM9990',
  '9990D00' => 'FM9990D00',
  '9999' => 'FM9999',
  '99999' => 'FM99999',
  '99999.99' => 'FM99999D99',
  '999999' => 'FM999999',
  '9999999' => 'FM9999999',
  '99999990' => 'FM99999990',
  '99999999' => 'FM99999999',
  '999999990' => 'FM999999990',
  '999999999' => 'FM999999999',
  '9999999990' => 'FM9999999990',
  '9999999990D00' => 'FM9999999990D00',
  '99999999990' => 'FM99999999990',
  '99999999999' => 'FM99999999999',
  '9999999999999999999999990D000' => 'FM9999999999999999999999990D000',
  '99999999999999D00' => 'FM99999999999999D00',
  '99999999999D00' => 'FM99999999999D00',
  '999999999D99' => 'FM999999999D99',
  '9999999D00' => 'FM9999999D00',
  '9999D99' => 'FM9999D99',
  '999D00' => 'FM999D00',
  '999D99' => 'FM999D99',
  '999G990D00' => 'FM999G990D00',
  '999G990D00MI' => '999G990D00MI',
  '999G999' => 'FM999G999',
  '999G999D00' => 'FM999G999D00',
  '999G999D00000' => 'FM999G999D00000',
  '999G999G990' => 'FM999G999G990',
  '999G999G990D00' => 'FM999G999G990D00',
  '999G999G990D0000MI' => '999G999G990D0000MI',
  '999G999G990D00MI' => '999G999G990D00MI',
  '999G999G990D99' => 'FM999G999G990D99',
  '999G999G999' => 'FM999G999G999',
  '999G999G999D99' => 'FM999G999G999D99',
  '999G999G999D99990' => 'FM999G999G999D99990',
  '999G999G999G990' => 'FM999G999G999G990',
  '999G999G999G990D00' => 'FM999G999G999G990D00',
  '999G999G999G999' => 'FM999G999G999G999',
  '999G999G999G999D00' => 'FM999G999G999G999D00',
  '999G999G999G999D99' => 'FM999G999G999G999D99',
  '999G999G999G999D9999' => 'FM999G999G999G999D9999',
  '999G999G999G999G990D00' => 'FM999G999G999G999G990D00',
  '999G999G999G999G999' => 'FM999G999G999G999G999',
  '999G999G999G999G999G990D00' => 'FM999G999G999G999G999G990D00',
  '99D00' => 'FM99D00',
  '99D9' => 'FM99D9',
  '99D99' => 'FM99D99',
  '99D9999' => 'FM99D9999',
  '99G990' => 'FM99G990',
  '99G999' => 'FM99G999',
  '99G999G990D00' => 'FM99G999G990D00',
  '99G999G999' => 'FM99G999G999',
  '99G999G999D00' => 'FM99G999G999D00',
  '99G999G999G990D00' => 'FM99G999G999G990D00',
  '99G999G99D9' => 'FM99G999G99D9',
  '99G99G999D99' => 'FM99G99G999D99',
  '99G99G99G999D99' => 'FM99G99G99G999D99',
  '9G990D00' => 'FM9G990D00',
  '9G990D0099' => 'FM9G990D0099',
  '9G990D99' => 'FM9G990D99',
  '9G999' => 'FM9G999',
  '9G999D99' => 'FM9G999D99',
  '9G999G990' => 'FM9G999G990',
  '9G999G990D00' => 'FM9G999G990D00',
  '9G999G999' => 'FM9G999G999',
  '9G999G999G999' => 'FM9G999G999G999',
  '9G99G99G999D99' => 'FM9G99G99G999D99',
  'FM999,999,990.00' => 'FM999G999G990D00',
  'fm99' => 'FM99',
  'fm999G999G999G990D00000MI' => 'FM999G999G999G990D00000MI',
  'fm999G999G999G990D0000MI' => 'FM999G999G999G990D0000MI',
  'fm999G999G999G990D00MI' => 'FM999G999G999G990D00MI'
  }

  Dir['../../src/forms/**/*.fmb'].each do |fmb_path|
    #puts '*'*80, "Processing: #{fmb_path}"

    form = FormModule.open(fmb_path)
    needs_saving = false

    blocks = form.blocks.select {|block| not block.name =~ /^(TOOLBAR|CALENDAR|PRINT|PRINT2|CALENDAR|WEBUTIL)$/}

    blocks.each do |block|
      #puts "Block: #{block.getName}"

      items = block.items.select {|item| masks_map.include? item.format_mask}
      items.delete_if {|item| item.data_type != 1} 
      items.each do |item|
        puts "#{block.name}.#{item.name} #{item.format_mask.inspect} => #{masks_map[item.format_mask].inspect} (#{item.lowest_allowed_value.inspect}, #{item.highest_allowed_value.inspect})"
        item.format_mask = masks_map[item.format_mask]
        needs_saving = true
      end
    end
    
    form.save fmb_path if needs_saving

    form.destroy
  end
end
